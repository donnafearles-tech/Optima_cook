{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firebaseUid": {
          "type": "string",
          "description": "The Firebase Authentication UID for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firebaseUid",
        "name",
        "email"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a cooking project created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Project)"
        },
        "name": {
          "type": "string",
          "description": "The name of the project."
        },
        "description": {
          "type": "string",
          "description": "A description of the project."
        }
      },
      "required": [
        "id",
        "ownerId",
        "name"
      ]
    },
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Represents a recipe within a cooking project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recipe."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Recipe)"
        },
        "name": {
          "type": "string",
          "description": "The name of the recipe."
        },
        "ingredients": {
          "type": "array",
          "description": "List of ingredients for the recipe",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "projectId",
        "name"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task within a recipe.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to Recipe. (Relationship: Recipe 1:N Task)"
        },
        "name": {
          "type": "string",
          "description": "The name of the task."
        },
        "duration": {
          "type": "number",
          "description": "The duration of the task in seconds."
        },
        "predecessorIds": {
          "type": "array",
          "description": "References to Tasks that must be completed before this task can start. (Relationship: Task N:N Task)",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "The status of the task (e.g., pending, in_progress, completed)."
        }
      },
      "required": [
        "id",
        "recipeId",
        "name",
        "duration",
        "predecessorIds",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter corresponds to the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores cooking projects created by a user. Includes 'ownerId' corresponding to the 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID for the user (project owner)."
            },
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": {
            "$ref": "#/backend/entities/Recipe"
          },
          "description": "Stores recipes within a cooking project. Includes denormalized 'projectId' and 'ownerId' (via the path) for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID for the user (project owner)."
            },
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            },
            {
              "name": "recipeId",
              "description": "Unique identifier for the recipe."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}/recipes/{recipeId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks within a recipe. Includes denormalized 'recipeId', 'projectId', and 'ownerId' (via the path) for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID for the user (project owner)."
            },
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            },
            {
              "name": "recipeId",
              "description": "Unique identifier for the recipe."
            },
            {
              "name": "taskId",
              "description": "Unique identifier for the task."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to prioritize authorization independence, clarity, and security, aligning with the specified principles. It leverages denormalization to avoid `get()` calls in security rules, ensuring atomic operations and easier debugging. Structural segregation is used to maintain homogeneous security postures within collections. Access modeling employs path-based ownership for user-owned data and membership maps for collaborative scenarios.\n\nUsers are stored in a top-level `users` collection. Each user's projects are stored in a subcollection `/users/{userId}/projects`. Recipes are stored as subcollections of projects `/users/{userId}/projects/{projectId}/recipes`, and tasks are stored as subcollections of recipes `/users/{userId}/projects/{projectId}/recipes/{recipeId}/tasks`. This hierarchical structure clearly represents the relationships between users, projects, recipes and tasks and enables easy, secure rules based on path ownership.\n\nAuthorization Independence is achieved because access control can be implemented by checking the user ID against the path hierarchy, without needing to read data from other documents. This approach is particularly important for the atomic creation of parent/child documents (e.g., creating a new task within a recipe).\n\nThis structure supports the required QAPs because list operations can be secured by verifying that the requesting user ID matches the `userId` parameter in the path, ensuring that users can only list projects, recipes, and tasks they own."
  }
}